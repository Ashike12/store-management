import{m as y,n as q,o as S,p as h,I as U,L as w,N as T,q as D,A as k,K as M,Q as _,S as B,j as e,U as E,C as F,F as z,v as G,V as R,W as O,X as K,Y as V,E as c,w as X,k as m,T as f}from"./index-DdhZj8dz.js";import{M as j}from"./MenuItem-JVALMa9o.js";import{B as x}from"./Button-2qfgqLe5.js";const Y=y({WholeSalerId:h(),PaymentAmount:S().required("Payment Amount is required").positive("Amount must be positive"),ProductSellInfo:q().of(y({ProductId:h().required("Product ID is required"),SellingPrice:S().required("Selling Price is required").positive("Selling Price must be positive"),Quantity:S().required("Quantity is required").positive("Quantity must be positive").integer("Quantity must be an integer"),SellingDate:h().required("Selling Date is required")})).min(1,"At least one product is required")}),J={PaymentAmount:0,ProductSellInfo:[{ItemId:"",ProductId:"",Quantity:0,SellingPrice:0,SellingDate:""}],WholeSalerId:""},Z=s=>{const r=s.ProductSellInfo.map(o=>({ItemId:o.ItemId,ProductId:o.ProductId,Quantity:o.Quantity,SellingPrice:o.SellingPrice,SellingDate:o.SellingDate}));return{PaymentAmount:s.PaymentAmount,ProductSellInfo:r,WholeSalerId:s.WholeSalerId}};function se(){const s=U();let{id:r}=w();r=r==="new"?"":r;const[o]=T(),I=o.get("isUpdate")==="true",{data:P,isLoading:b}=D({pageNumber:1,pageSize:1e3,itemId:""}),{data:g,isLoading:N}=k({pageNumber:1,pageSize:10,itemId:""}),{data:u,isLoading:H}=M({pageNumber:1,pageSize:10,itemId:r??""}),[A,{isLoading:ee}]=_(),[Q,{isLoading:te}]=B(),v=(P==null?void 0:P.Data)||[],$=(g==null?void 0:g.Data)||[];if(b||N)return e.jsx(E,{});console.log(u);const C=t=>{s(`/invoice/${t}/${r}`)},W=async t=>{if(console.log("Form data",t),I){const i=t;i.ItemId=r??"",console.log("Update payload",i),await Q({payload:i}).unwrap()}else await A({payload:t}).unwrap();s("/invoice")};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full",children:[r!==""&&e.jsx(F,{onClick:()=>C("details"),className:"fixed bottom-4 right-4 ml-4 my-3 cursor-pointer",text:"DETAILS_INVOICE",variant:"primary"}),e.jsxs("div",{className:"max-w-3xl mx-auto p-6 bg-white shadow-lg rounded-xl mt-10",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 border-b pb-3",children:I?"Invoice Update":"Invoice Add"}),e.jsx("div",{className:"mt-4 space-y-2",children:e.jsx(z,{initialValues:I?Z(u==null?void 0:u.Data):J,validationSchema:Y,onSubmit:t=>{console.log("Form data",t)},children:({values:t,setFieldValue:i,errors:ae,touched:ne})=>{const p=t.ProductSellInfo.map(l=>l.ProductId),L=t.ProductSellInfo.reduce((d,a)=>d+a.SellingPrice*a.Quantity,0);return e.jsxs(G,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(R,{fullWidth:!0,children:[e.jsx(O,{children:"Wholesaler"}),e.jsx(K,{as:V,name:"WholeSalerId",label:"Wholesaler",children:$.map(l=>e.jsx(j,{value:l.ItemId,children:l.DisplayName},l.ItemId))}),e.jsx(c,{name:"WholeSalerId",component:"div",className:"text-red-500"})]})}),e.jsx(X,{name:"ProductSellInfo",render:l=>e.jsxs("div",{children:[t.ProductSellInfo.map((d,a)=>e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{label:"Product ID",name:`ProductSellInfo[${a}].ProductId`,fullWidth:!0,variant:"outlined",select:!0,value:d.ProductId+"_"+d.SellingPrice,onChange:n=>{i(`ProductSellInfo[${a}].ProductId`,n.target.value.split("_")[0]),i(`ProductSellInfo[${a}].SellingPrice`,n.target.value.split("_")[1]),i(`ProductSellInfo[${a}].Quantity`,5)},children:v.map(n=>e.jsx(j,{disabled:p.indexOf(n.ItemId)>-1,value:n.ItemId+"_"+n.SellingPrice,children:n.ProductName},n.ItemId))}),e.jsx(c,{name:`ProductSellInfo[${a}].ProductId`,component:"div",className:"text-red-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{label:"Selling Price",name:`ProductSellInfo[${a}].SellingPrice`,type:"number",fullWidth:!0,variant:"outlined",value:d.SellingPrice,onChange:n=>i(`ProductSellInfo[${a}].SellingPrice`,n.target.value)}),e.jsx(c,{name:`ProductSellInfo[${a}].SellingPrice`,component:"div",className:"text-red-500"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{label:"Quantity",name:`ProductSellInfo[${a}].Quantity`,type:"number",fullWidth:!0,variant:"outlined",value:d.Quantity,onChange:n=>i(`ProductSellInfo[${a}].Quantity`,n.target.value)}),e.jsx(c,{name:`ProductSellInfo[${a}].Quantity`,component:"div",className:"text-red-500"})]}),t.ProductSellInfo.length>1&&e.jsx(x,{type:"button",variant:"outlined",color:"secondary",onClick:()=>l.remove(a),children:"Remove Product"})]})},a)),p.length!=v.length&&e.jsx(x,{type:"button",variant:"outlined",color:"primary",onClick:()=>l.push({ProductId:"",Quantity:0,SellingPrice:0,SellingDate:""}),children:"Add Product"})]})}),e.jsxs("div",{className:"flex flex-row gap-4 mt-6",children:[e.jsxs("div",{className:"mb-4 basis-1/2",children:[e.jsx(m,{label:"Payment Amount",name:"PaymentAmount",type:"number",fullWidth:!0,variant:"outlined",value:t.PaymentAmount,onChange:l=>i("PaymentAmount",l.target.value)}),e.jsx(c,{name:"PaymentAmount",component:"div",className:"text-red-500"})]}),e.jsxs("div",{className:"basis-1/2 border flex items-center border-transparent-grey-24 rounded-md px-4 mb-4",children:[e.jsx(f,{variant:"Body1",content:"TOTAL_AMOUNT"}),":",e.jsx(f,{variant:"Subtitle1Bold",content:L})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(x,{onClick:()=>W(t),disabled:!t.ProductSellInfo.length||!t.PaymentAmount,type:"submit",variant:"contained",color:"primary",children:"Submit Invoice"})})]})}})})]})]})})}export{se as default};
